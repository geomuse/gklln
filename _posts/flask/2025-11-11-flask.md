---
layout: post
title:  python flask-wtf-simple
date:   2025-11-11 11:24:29 +0800
tags: 
    - python 
    - flask
image: 07.jpg
---

## Python Flask 表单的创建（Form in Python Flask）

在 Python Flask 中构建**表单**主要涉及三个部分：在 Python 中定义路由和逻辑、在模板中创建 HTML 表单，以及处理数据提交。您有两种主要方法：使用 Flask 内置的 `request` 对象处理基本表单，或使用 **Flask-WTF** 扩展处理具有验证和 CSRF 保护等功能的复杂表单。

## 基础表单处理（使用 `request`）

对于简单表单，您可以直接使用 Flask 的 `request.form` 对象访问提交的数据。

### **Python 代码（例如 `app.py`）**

在您的路由装饰器中使用 `methods=['GET', 'POST']` 参数。`GET` 用于最初查看页面，`POST` 用于提交表单数据。使用 `request.form['field_name']` 来访问数据。

```python
from flask import Flask, render_template, request

app = Flask(__name__)

@app.route('/', methods=['GET', 'POST'])
def handle_form():
    if request.method == 'POST':
        # 从表单中获取数据，使用 HTML 中的 'name' 属性
        name = request.form['username']
        # 您现在可以处理数据（例如，保存到数据库）
        return f'Hello, {name}! 您的表单已提交。'
    
    # 对于 GET 请求，渲染表单模板
    return render_template('form.html')

if __name__ == '__main__':
    app.run(debug=True)
```

-----

### **HTML 模板（例如 `templates/form.html`）**

在名为 `templates` 的目录中创建一个 HTML 文件。关键部分是：

  * `<form>` 元素必须有 `method="post"` 和一个 `action`（对于简单表单，通常留空或设置为相同的路由 `/`）。
  * 所有输入字段都必须有一个 `name` 属性，这是您在 Flask 中检索数据时使用的键（例如，`request.form['username']`）。

<!-- end list -->

```html
<!doctype html>
<html>
<head>
    <title>基本 Flask 表单</title>
</head>
<body>
    <h1>用户输入表单</h1>
    <form method="post" action="/">
        <label for="username">姓名:</label>
        <input type="text" id="username" name="username" required>
        <br><br>
        <input type="submit" value="提交">
    </form>
</body>
</html>
```

-----

## 高级表单（使用 Flask-WTF）

对于实际应用，推荐的方法是使用 **Flask-WTF** 扩展，它封装了 **WTForms** 库，并处理了诸如 **CSRF 保护**和内置**验证**等关键安全功能。

### **设置：**

1.  **安装：** `pip install Flask-WTF`
2.  **配置：** 您的 Flask 应用需要一个 `SECRET_KEY` 来保障安全。

<!-- end list -->

```python
app.config['SECRET_KEY'] = 'a-very-secret-key-that-you-should-change'
```

### **定义表单类（例如 `forms.py`）**

创建一个继承自 `FlaskForm` 的 Python 类，并定义您的字段和验证规则。

```python
from flask_wtf import FlaskForm
from wtforms import StringField, SubmitField
from wtforms.validators import DataRequired, Length

class SimpleUserForm(FlaskForm):
    # 带有标签和验证器（例如，不能为空）的字段
    username = StringField('用户名', validators=[DataRequired(), Length(min=4, max=25)])
    
    # 提交按钮
    submit = SubmitField('注册')
```

### **Python 路由（例如 `app.py`）**

实例化表单，并使用 `form.validate_on_submit()` 来检查表单是否通过 POST 提交且有效。如果有效，使用 `form.field_name.data` 访问数据。

```python
from flask import Flask, render_template, redirect, url_for
from forms import SimpleUserForm # 假设 forms.py 在同一目录下

# ... (带有 SECRET_KEY 的应用配置)

@app.route('/signup', methods=['GET', 'POST'])
def signup():
    form = SimpleUserForm()

    if form.validate_on_submit():
        # 数据有效且已提交
        name = form.username.data
        
        # 在实际应用中，您会将此数据保存到数据库
        print(f"用户注册: {name}") 
        
        # 重定向用户以防止刷新时重复提交
        return redirect(url_for('success', user=name))
    
    # 渲染模板，用于 GET 请求或验证失败时
    return render_template('signup.html', form=form)

@app.route('/success/<user>')
def success(user):
    return f'成功! 欢迎您, {user}!'
```

### **HTML 模板（例如 `templates/signup.html`）**

模板使用 Jinja2 语法来渲染表单，包括自动渲染隐藏的 CSRF 令牌和任何验证错误。

```html
<!doctype html>
<html>
<head>
    <title>Flask-WTF 表单</title>
</head>
<body>
    <h1>注册</h1>
    <form method="POST" action=""> 
        {{ form.hidden_tag() }} 

        {{ form.username.label }}
        {{ form.username() }}
        
        {% for error in form.username.errors %}
            <span style="color: red;">[{{ error }}]</span>
        {% endfor %}
        
        <br><br>
        
        {{ form.submit() }}
    </form>
</body>
</html>
```