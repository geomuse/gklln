---
layout: post
title:  python flask è“å›¾
date:   2025-11-16 11:24:29 +0800
tags: 
    - python 
    - flask
image: 07.jpg
---

æ‚¨å¥½ï¼Flask çš„**è“å›¾ (Blueprint)** æ˜¯ç»„ç»‡å¤§å‹ Flask åº”ç”¨ã€å®ç°æ¨¡å—åŒ–å’Œä»£ç é‡ç”¨çš„æ ¸å¿ƒæœºåˆ¶ã€‚

## Flask è“å›¾ (Blueprint) ç®€ä»‹

è“å›¾çš„ä½œç”¨ç±»ä¼¼äºä¸€ä¸ªå¾®å‹åº”ç”¨ï¼Œå®ƒå¯ä»¥å®šä¹‰è·¯ç”±ã€æ¨¡æ¿æ–‡ä»¶å¤¹ã€é™æ€æ–‡ä»¶ç­‰ï¼Œä½†å®ƒ**ä¸æ˜¯ä¸€ä¸ªçœŸæ­£çš„åº”ç”¨**ï¼Œéœ€è¦æ³¨å†Œåˆ°ä¸€ä¸ªä¸» Flask åº”ç”¨å®ä¾‹ä¸Šæ‰èƒ½ç”Ÿæ•ˆã€‚

**ä¸»è¦ç”¨é€”ï¼š**

1.  **æ¨¡å—åŒ–ï¼š** å°†ä¸€ä¸ªå¤§å‹åº”ç”¨åˆ†è§£ä¸ºå¤šä¸ªç‹¬ç«‹çš„ã€åŠŸèƒ½ç›¸å…³çš„ç»„ä»¶ï¼ˆä¾‹å¦‚ï¼šç”¨æˆ·ç®¡ç†ã€åšå®¢æ–‡ç« ã€API æ¥å£ï¼‰ã€‚
2.  **ä»£ç é‡ç”¨ï¼š** å¯ä»¥åœ¨åŒä¸€ä¸ªåº”ç”¨ä¸­ä»¥ä¸åŒçš„ URL å‰ç¼€å¤šæ¬¡æ³¨å†ŒåŒä¸€ä¸ªè“å›¾ï¼Œæˆ–è€…åœ¨ä¸åŒçš„é¡¹ç›®ä¸­é‡å¤ä½¿ç”¨è“å›¾ã€‚
3.  **URL å‰ç¼€ï¼š** å¯ä»¥ä¸ºè“å›¾ä¸‹çš„æ‰€æœ‰è·¯ç”±ç»Ÿä¸€æ·»åŠ ä¸€ä¸ª URL å‰ç¼€ï¼Œé¿å…å‘½åå†²çªã€‚

## è“å›¾åŸºæœ¬å®ç°æ­¥éª¤

å®ç°ä¸€ä¸ª Flask è“å›¾é€šå¸¸åŒ…æ‹¬ä¸‰ä¸ªæ­¥éª¤ï¼š**åˆ›å»ºè“å›¾**ã€**å®šä¹‰è·¯ç”±**å’Œ**æ³¨å†Œè“å›¾**ã€‚

### åˆ›å»ºè“å›¾ (`user_routes.py`)

åœ¨ä¸€ä¸ªå•ç‹¬çš„ Python æ–‡ä»¶ï¼ˆä¾‹å¦‚ `user_routes.py`ï¼‰ä¸­åˆ›å»ºè“å›¾å®ä¾‹ã€‚

```python
# user_routes.py
from flask import Blueprint, render_template

# å®ä¾‹åŒ–ä¸€ä¸ªè“å›¾å¯¹è±¡
# 'user_bp' æ˜¯è“å›¾çš„åç§° (name)ï¼Œç”¨äº url_for()
# __name__ æ˜¯è“å›¾çš„å¯¼å…¥åç§°ï¼ŒFlask ç”¨å®ƒæ¥å®šä½èµ„æºï¼ˆå¦‚æ¨¡æ¿å’Œé™æ€æ–‡ä»¶ï¼‰
user_bp = Blueprint('user_bp', __name__, 
                    template_folder='templates') # å¯é€‰ï¼šæŒ‡å®šè“å›¾ä¸“ç”¨çš„æ¨¡æ¿æ–‡ä»¶å¤¹

@user_bp.route('/')
def index():
    # è¿™é‡Œçš„è·¯ç”±æ˜¯ç›¸å¯¹äºè“å›¾çš„
    return "è¿™æ˜¯ç”¨æˆ·æ¨¡å—çš„é¦–é¡µ"

@user_bp.route('/<int:user_id>')
def get_user(user_id):
    return f"è·å–ç”¨æˆ· ID: {user_id} çš„ä¿¡æ¯"
```

### ä¸»åº”ç”¨ (`app.py`)

åœ¨ä¸»åº”ç”¨æ–‡ä»¶ï¼ˆä¾‹å¦‚ `app.py`ï¼‰ä¸­åˆ›å»º Flask åº”ç”¨å®ä¾‹ï¼Œå¹¶æ³¨å†Œè“å›¾ã€‚

```python
# app.py
from flask import Flask
# ä» user_routes.py å¯¼å…¥è“å›¾å®ä¾‹
from user_routes import user_bp 

def create_app():
    app = Flask(__name__)
    
    # æ³¨å†Œè“å›¾
    # url_prefix='/users' è¡¨ç¤º user_bp è“å›¾ä¸‹çš„æ‰€æœ‰è·¯ç”±éƒ½ä¼šä»¥ /users/ å¼€å¤´
    app.register_blueprint(user_bp, url_prefix='/users')
    
    return app

if __name__ == '__main__':
    app = create_app()
    app.run(debug=True)
```

### è¿è¡Œæ•ˆæœ

è¿è¡Œ `app.py`ï¼š

  * è®¿é—® `/`ï¼šä¼šæ˜¯ä¸»åº”ç”¨ä¸­æœªæ³¨å†Œè“å›¾çš„ä»»ä½•è·¯ç”±ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰ã€‚
  * è®¿é—® `/users/`ï¼šä¼šè§¦å‘ `user_bp` è“å›¾ä¸­çš„ `index()` å‡½æ•°ã€‚
  * è®¿é—® `/users/123`ï¼šä¼šè§¦å‘ `user_bp` è“å›¾ä¸­çš„ `get_user(123)` å‡½æ•°ã€‚

## è“å›¾ä¸­çš„ `url_for()`

åœ¨ä½¿ç”¨è“å›¾åï¼Œ`url_for()` å‡½æ•°çš„ç”¨æ³•ä¹Ÿéœ€è¦æ”¹å˜ï¼Œä»¥é¿å…ä¸åŒè“å›¾ä¹‹é—´è·¯ç”±åç§°çš„å†²çªã€‚

æ ¼å¼å˜ä¸ºï¼š`url_for('è“å›¾åç§°.è§†å›¾å‡½æ•°åç§°')`

  * **åœ¨ä¸»åº”ç”¨ä¸­æˆ–å…¶ä»–è“å›¾ä¸­å¼•ç”¨ `user_bp` çš„è·¯ç”±ï¼š**
    ```python
    # ç”Ÿæˆ /users/100 çš„é“¾æ¥
    url_for('user_bp.get_user', user_id=100) 
    ```
  * **åœ¨ `user_bp` è“å›¾å†…éƒ¨å¼•ç”¨è‡ªèº«çš„è·¯ç”±ï¼š**
    ```python
    # ç”Ÿæˆ /users/ çš„é“¾æ¥
    url_for('user_bp.index')
    # æˆ–è€…ç›´æ¥ä½¿ç”¨ç›¸å¯¹å¼•ç”¨ (æ›´æ¨è)
    url_for('.index') 
    ```

## ğŸ’¡ è¿›é˜¶åŠŸèƒ½

  * **é™æ€æ–‡ä»¶å’Œæ¨¡æ¿ï¼š** è“å›¾å¯ä»¥æœ‰è‡ªå·±çš„é™æ€æ–‡ä»¶å’Œæ¨¡æ¿æ–‡ä»¶å¤¹ï¼Œé€šè¿‡åœ¨ `Blueprint` æ„é€ å‡½æ•°ä¸­è®¾ç½® `static_folder` å’Œ `template_folder` å‚æ•°æŒ‡å®šã€‚
  * **é”™è¯¯å¤„ç†ï¼š** è“å›¾ä¹Ÿå¯ä»¥ä½¿ç”¨ `@user_bp.errorhandler(404)` æ¥å®šä¹‰è‡ªå·±çš„é”™è¯¯å¤„ç†å‡½æ•°ã€‚
  * **è¯·æ±‚å¤„ç†å™¨ï¼š** è“å›¾æ”¯æŒ `@user_bp.before_request`ã€`@user_bp.after_request` ç­‰è¯·æ±‚é’©å­ã€‚