---
layout: post
title: 金融学投资组合 VaR CVaR
date:  2025-08-27 09:01:00 +0800
image: 08.jpg
tags: 
    - python
    - financial
    - fintech
---

### 📌 1. 什么是 VaR（Value at Risk，风险价值）

VaR 衡量的是在一定置信水平下，投资组合在未来某一时间段内**可能的最大损失**。

**公式表达：**

* 在置信水平 $\alpha$ 下，VaR 是满足以下条件的损失水平：

$$
P(Loss > VaR_\alpha) = 1 - \alpha
$$

例子：

* 1 日 95% VaR = -5%
  解释：在 95% 的情况下，组合未来 1 天的损失不会超过 5%。

---

### 📌 2. 什么是 CVaR（Conditional VaR / Expected Shortfall）

CVaR 是在 VaR 之外的损失的平均值，即**最坏情况下的平均损失**。

$$
CVaR_\alpha = E[ Loss \mid Loss > VaR_\alpha ]
$$

👉 CVaR 比 VaR 更严格，因为它考虑了尾部风险。
👉 在监管（如巴塞尔协议）和风险管理中，CVaR 被广泛应用。

---

### 📌 3. VaR 的计算方法

1. **历史模拟法（Historical Simulation）**

   * 直接基于历史收益分布计算分位数。
   * 简单直观，但依赖历史数据。

2. **方差-协方差法（Variance-Covariance，Parametric VaR）**

   * 假设收益服从正态分布：

   $$
   VaR = Z_\alpha \cdot \sigma - \mu
   $$

   * 其中 $Z_\alpha$ 是置信水平下的正态分位数。

3. **蒙特卡洛模拟（Monte Carlo Simulation）**

   * 假设收益分布，随机生成大量收益样本，估计 VaR。
   * 更灵活，可处理非正态分布。

---

### 📌 4. Python 示例：历史模拟 VaR & CVaR

```python
import numpy as np
import pandas as pd

# 假设有组合日收益
returns = df['portfolio_return']

# 参数设置
confidence_level = 0.95

# 计算VaR（历史模拟法）
VaR = np.percentile(returns, (1 - confidence_level) * 100)

# 计算CVaR（尾部平均）
CVaR = returns[returns <= VaR].mean()

print(f"{int(confidence_level*100)}% 置信水平下的 1日VaR: {VaR:.4f}")
print(f"{int(confidence_level*100)}% 置信水平下的 1日CVaR: {CVaR:.4f}")
```

---

### 📌 5. 应用场景

* **银行/基金风险管理**：设定每日损失上限。
* **投资组合优化**：用 CVaR 代替方差，构建稳健组合。
* **监管合规**：巴塞尔协议要求金融机构测算并披露 VaR/CVaR。

---

✅ 小结：

* **VaR = 损失的分位数**（告诉你“最多亏多少”）。
* **CVaR = 坏情况平均损失**（告诉你“如果真的坏，会亏多少”）。
* CVaR 更稳健，因此现代组合优化中更常用 CVaR。